(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const I=document.querySelector("#courseTemplate");I.removeAttribute("id");I.remove();const U=document.querySelector("#courseDetailsTemplate");U.removeAttribute("id");U.remove();const L=document.querySelector("#lessonTemplate");L.removeAttribute("id");L.remove();const B=document.querySelector("#lessonOngoingTemplate");B.removeAttribute("id");B.remove();const $=await(await fetch("dist-data/courses/index.json")).json(),A=document.querySelector(".courseList"),H=document.querySelector(".courseDetails"),E=document.querySelector(".lessonOngoing");R();function j(e,t){const o=JSON.parse(localStorage.knowledge||"{}")?.[e]?.[t];if(!o)return"unseen";const l=new Date().getTime();return o.lastAnswersCorrect.length>2&&o.lastAnswersCorrect.every(n=>n)&&l<o.hiddenUntil?"learned":o.lastAnswersCorrect.find((n,s)=>!n&&o.lastAnswersCorrect.length-s<=3)===!1?"wrong":"somewhat"}function F(e,t){const o=$[t],l=Object.keys(JSON.parse(localStorage.knowledge||"{}")?.[t]||{});b(e,t,l,o.exercises)}function b(e,t,o,l){const n=o.map(r=>j(t,r)),s=n.filter(r=>r==="wrong").length,d=n.filter(r=>r==="somewhat").length,p=n.filter(r=>r==="learned").length,w=l-s-d-p;e.querySelector(".wrong").style.flex=s,e.querySelector(".somewhat").style.flex=d,e.querySelector(".learned").style.flex=p,e.querySelector(".unseen").style.flex=w}function R(){A.innerHTML="";const e=Object.keys($);for(const t of e){const o=$[t],l=I.cloneNode(!0);l.querySelector(".title").append(t),l.querySelector(".hint").append(`${o.lessons} lessons, ${o.exercises} exercises`),l.addEventListener("click",()=>C(t)),F(l.querySelector(".progress"),t),A.append(l)}A.style.display="block",H.style.display="none",E.style.display="none"}async function C(e){const t=await(await fetch("dist-data/courses/"+encodeURI(e+".json"))).json();H.innerHTML="";const o=U.cloneNode(!0);o.querySelector(".title").append(`${t.from} to ${t.to}`),F(o.querySelector(".progress"),e),o.querySelector(".buttonBack").addEventListener("click",()=>R());const l=o.querySelector(".lessons");for(const r of[...t.lessons].sort((i,c)=>i.order-c.order)){const i=L.cloneNode(!0);i.querySelector(".title").append(r.title[t.to]),i.querySelector(".hint").append(`${r.exercises.length} exercises`),b(i.querySelector(".progress"),e,r.exercises,r.exercises.length),i.addEventListener("click",()=>Y(t,r)),l.append(i)}const n=new Set;t.exercerciseList.flatMap(r=>r.categories).forEach(r=>n.add(r));const s=Array.from(n).sort(),d=o.querySelector(".categories");for(const r of s){const i=L.cloneNode(!0);i.querySelector(".title").append(r);const c=t.exercerciseList.filter(y=>y.categories.includes(r));i.querySelector(".hint").append(`${c.length} exercises`),b(i.querySelector(".progress"),e,c.map(y=>y.conceptName),c.length),i.addEventListener("click",()=>J(t,c)),d.append(i)}const p={Training:t.exercerciseList.filter(r=>["wrong","somewhat"].includes(j(e,r.conceptName))),New:t.exercerciseList.filter(r=>j(e,r.conceptName)==="unseen"),Uncategorized:t.exercerciseList.filter(r=>r.categories.length===0)},w=o.querySelector(".dynamicCategories");for(const[r,i]of Object.entries(p)){const c=L.cloneNode(!0);c.querySelector(".title").append(r),c.querySelector(".hint").append(`${i.length} exercises`),b(c.querySelector(".progress"),e,i.map(y=>y.conceptName),i.length),i.length>0&&c.addEventListener("click",()=>J(t,i)),w.append(c)}H.append(o),A.style.display="none",H.style.display="block",E.style.display="none"}function Y(e,t){const o=e.exercerciseList.filter(l=>t.exercises.includes(l.conceptName));z(e,o)}function J(e,t){z(e,t)}function v(e){return e[Math.floor(Math.random()*e.length)]}function G(e,t,o,l){const n=t.filter(s=>s!==e&&!l.includes(s));if(Math.random()>.5){const s=n.filter(d=>d.categories.some(p=>e.categories.includes(p)));if(s.length>0)return v(s)}if(Math.random()>.5){const s=n.filter(d=>{const p=d.translations[o][0].text.length/e.translations[o][0].text.length;return p>.5&&p<1.5});if(s.length>0)return v(s)}return v(n)}function Q(e,t,o,l){const n=[];for(;n.length<t;)n.push(G(e,o,l,n));return n}function X(e,t){const o=/[.多?,?!;-]/g;return e.replace(o,"").toLowerCase()===t.replace(o,"").toLowerCase()}function z(e,t){const o=Math.min(10,t.length),l=[...t],n=[];for(;n.length<o;){const f=Math.floor(Math.random()*l.length);n.push(...l.splice(f,1))}E.innerHTML="";const s=B.cloneNode(!0),d=s.querySelector("progress");d.max=o,d.value=0;const p=s.querySelector(".correctAnswerHint"),w=s.querySelector(".correctAnswer"),r=s.querySelector(".pickAnswer"),i=s.querySelector(".typeAnswer"),c=s.querySelector("input"),y=s.querySelector(".wordSuggestions"),k=s.querySelector(".questionHint");let a;function N(){a=n.splice(0,1)[0],d.value=o-n.length,s.querySelector(".question").innerHTML="";const f=v(a.translations[e.from]);s.querySelector(".question").append(f.text);const S=a.descriptions?.[e.from];S?(k.innerText=S,k.style.display="block"):k.style.display="none",s.querySelector(".buttonDefinition").addEventListener("click",()=>W(a,f.text,e.from)),p.style.display="none",c.value="",Math.random()>.5&&f.text.includes(" ")?(r.style.display="none",i.style.display="block"):(r.style.display="block",i.style.display="none"),s.querySelectorAll(".pickAnswer p.answer").forEach(u=>u.remove());const m=Q(a,2,e.exercerciseList,e.to),x=v(a.translations[e.to]),h=[x,...m.map(u=>v(u.translations[e.to]))];h.sort(()=>Math.random()-.5);for(const u of h){const g=document.createElement("p");g.className="answer",g.append(u.text),g.addEventListener("click",()=>{c.value=u.text,T()}),r.append(g);const M=document.createElement("button");M.append("Info");const K=m.find(D=>Object.values(D.translations[e.to]).some(V=>V===u))||a;M.addEventListener("click",D=>{D.stopPropagation(),W(K,u.text,e.to)}),g.append(M)}y.innerHTML="";const O=Array.from(new Set([...h.flatMap(u=>u.text.split(/\s+|[.多?,?!;]/)).filter(u=>u!==""),...h.flatMap(u=>Array.from(new Set(u.text.replace(/[^.多?,?!;]/g,""))))])).sort(()=>Math.random()-.5);for(const u of O){const g=document.createElement("p");g.className="wordSuggestion",g.append(u),g.addEventListener("click",()=>{c.value===""?c.value=u:/^[.多?,?!;]$/.test(u)?c.value=c.value+u:c.value=c.value+" "+u}),y.append(g)}w.innerHTML="",w.append(x.text)}function T(){if(p.style.display==="none"){const f=a.translations[e.to].some(x=>X(x.text,c.value)),S=JSON.parse(localStorage.knowledge||"{}"),m=S?.[q]?.[a.conceptName]||{lastAnswersCorrect:[],hiddenUntil:0};if(S[q]||(S[q]={}),S[q][a.conceptName]=m,m.lastAnswersCorrect.length>9&&m.lastAnswersCorrect.splice(0,1),m.lastAnswersCorrect.push(f),!f)m.hiddenUntil=0;else{const x=m.lastAnswersCorrect.reduce((h,O)=>O?h+1:h-1,0);m.lastAnswersCorrect.length<10?m.hiddenUntil=new Date().getTime()+x*6e5:m.hiddenUntil=new Date().getTime()+x*864e5}localStorage.knowledge=JSON.stringify(S),f?n.length>0?N():C(q):(r.style.display="none",i.style.display="none",p.querySelector(".wrongAnswer").innerText=c.value,p.style.display="block")}else n.length>0?N():C(q)}const q=`${e.from} to ${e.to}`;s.querySelector(".buttonBack").addEventListener("click",()=>C(q)),s.querySelector(".buttonConfirm").addEventListener("click",()=>T()),c.addEventListener("keypress",f=>{f.key==="Enter"&&T()}),N(),E.append(s),A.style.display="none",H.style.display="none",E.style.display="block"}document.querySelector(".definitionOverlay .buttonBack").addEventListener("click",()=>Z());function Z(){document.querySelector(".definitionOverlay").style.display="none"}const _={"https://creativecommons.org/licenses/by-sa/3.0/":"CC BY-SA 3.0"};function W(e,t,o){const l=document.querySelector(".definitionOverlay");l.querySelector(".title").innerText=t;const n=l.querySelector(".hint"),s=e.descriptions?.[o];s?(n.innerText=s,n.style.display="block"):n.style.display="none";const d=l.querySelector(".translations");d.innerHTML="";for(const[p,w]of Object.entries(e.translations)){const r=document.createElement("h2");r.append(`Translations: ${p}`),d.append(r);const i=speechSynthesis.getVoices().filter(c=>c.lang.startsWith(p));for(const c of w){const y=document.createElement("div");y.className="translation",d.append(y);const k=document.createElement("h3");if(k.append(c.text),y.append(k),i.length>0){const a=document.createElement("button");a.append("Speak"),a.addEventListener("click",()=>P(c.text,i)),y.append(a)}if(c.source){const a=document.createElement("a");a.href=c.source,a.append(a.hostname),y.append(a)}if(c.licence){const a=document.createElement("a");a.href=c.licence,a.append(`Licence: ${_[c.licence]||c.licence}`),y.append(a)}}}document.querySelector(".definitionOverlay").style.display="flex"}function P(e,t){const o=new SpeechSynthesisUtterance(e);o.voice=v(t),speechSynthesis.speak(o)}
