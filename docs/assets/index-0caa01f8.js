(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();const I=document.querySelector("#courseTemplate");I.removeAttribute("id");I.remove();const U=document.querySelector("#courseDetailsTemplate");U.removeAttribute("id");U.remove();const k=document.querySelector("#lessonTemplate");k.removeAttribute("id");k.remove();const B=document.querySelector("#lessonOngoingTemplate");B.removeAttribute("id");B.remove();const $=await(await fetch("dist-data/courses/index.json")).json(),A=document.querySelector(".courseList"),H=document.querySelector(".courseDetails"),E=document.querySelector(".lessonOngoing");W();function j(e,o){const s=JSON.parse(localStorage.knowledge||"{}")?.[e]?.[o];if(!s)return"unseen";const i=new Date().getTime();return s.lastAnswersCorrect.length>2&&s.lastAnswersCorrect.every(t=>t)&&i<s.hiddenUntil?"learned":s.lastAnswersCorrect.find((t,n)=>!t&&s.lastAnswersCorrect.length-n<=3)===!1?"wrong":"somewhat"}function R(e,o){const s=$[o],i=Object.keys(JSON.parse(localStorage.knowledge||"{}")?.[o]||{});C(e,o,i,s.exercises)}function C(e,o,s,i){const t=s.map(r=>j(o,r)),n=t.filter(r=>r==="wrong").length,a=t.filter(r=>r==="somewhat").length,u=t.filter(r=>r==="learned").length,S=i-n-a-u;e.querySelector(".wrong").style.flex=n,e.querySelector(".somewhat").style.flex=a,e.querySelector(".learned").style.flex=u,e.querySelector(".unseen").style.flex=S}function W(){A.innerHTML="";const e=Object.keys($);for(const o of e){const s=$[o],i=I.cloneNode(!0);i.querySelector(".title").append(o),i.querySelector(".hint").append(`${s.lessons} lessons, ${s.exercises} exercises`),i.addEventListener("click",()=>b(o)),R(i.querySelector(".progress"),o),A.append(i)}A.style.display="block",H.style.display="none",E.style.display="none"}async function b(e){const o=await(await fetch("dist-data/courses/"+encodeURI(e+".json"))).json();H.innerHTML="";const s=U.cloneNode(!0);s.querySelector(".title").append(`${o.from} to ${o.to}`),R(s.querySelector(".progress"),e),s.querySelector(".buttonBack").addEventListener("click",()=>W());const i=s.querySelector(".lessons");for(const r of[...o.lessons].sort((c,l)=>c.order-l.order)){const c=k.cloneNode(!0);c.querySelector(".title").append(r.title[o.to]),c.querySelector(".hint").append(`${r.exercises.length} exercises`),C(c.querySelector(".progress"),e,r.exercises,r.exercises.length),c.addEventListener("click",()=>G(o,r)),i.append(c)}const t=new Set;o.exercerciseList.flatMap(r=>r.categories).forEach(r=>t.add(r));const n=Array.from(t).sort(),a=s.querySelector(".categories");for(const r of n){const c=k.cloneNode(!0);c.querySelector(".title").append(r);const l=o.exercerciseList.filter(m=>m.categories.includes(r));c.querySelector(".hint").append(`${l.length} exercises`),C(c.querySelector(".progress"),e,l.map(m=>m.conceptName),l.length),c.addEventListener("click",()=>J(o,l)),a.append(c)}const u={Training:o.exercerciseList.filter(r=>["wrong","somewhat"].includes(j(e,r.conceptName))),New:o.exercerciseList.filter(r=>j(e,r.conceptName)==="unseen"),Uncategorized:o.exercerciseList.filter(r=>r.categories.length===0)},S=s.querySelector(".dynamicCategories");for(const[r,c]of Object.entries(u)){const l=k.cloneNode(!0);l.querySelector(".title").append(r),l.querySelector(".hint").append(`${c.length} exercises`),C(l.querySelector(".progress"),e,c.map(m=>m.conceptName),c.length),c.length>0&&l.addEventListener("click",()=>J(o,c)),S.append(l)}H.append(s),A.style.display="none",H.style.display="block",E.style.display="none"}function G(e,o){const s=e.exercerciseList.filter(i=>o.exercises.includes(i.conceptName));z(e,s)}function J(e,o){z(e,o)}function L(e){return e[Math.floor(Math.random()*e.length)]}function Q(e,o,s,i){const t=o.filter(n=>n!==e&&!i.includes(n));if(Math.random()>.5){const n=t.filter(a=>a.categories.some(u=>e.categories.includes(u)));if(n.length>0)return L(n)}if(Math.random()>.5){const n=t.filter(a=>{const u=a.translations[s][0].text.length/e.translations[s][0].text.length;return u>.5&&u<1.5});if(n.length>0)return L(n)}return L(t)}function V(e,o,s,i){const t=[];for(;t.length<o;)t.push(Q(e,s,i,t));return t}function X(e,o){const s=/[.多?,?!;-]/g;return e.replace(s,"").toLowerCase()===o.replace(s,"").toLowerCase()}function z(e,o){const s=Math.min(10,o.length),i=[...o],t=[];for(;t.length<s;){const f=Math.floor(Math.random()*i.length);t.push(...i.splice(f,1))}E.innerHTML="";const n=B.cloneNode(!0),a=n.querySelector("progress");a.max=s,a.value=0;const u=n.querySelector(".correctAnswerHint"),S=n.querySelector(".correctAnswer"),r=n.querySelector(".pickAnswer"),c=n.querySelector(".typeAnswer"),l=n.querySelector("input"),m=n.querySelector(".wordSuggestions"),p=n.querySelector(".questionHint");let g;function N(){g=t.splice(0,1)[0],a.value=s-t.length,n.querySelector(".question").innerHTML="";const f=L(g.translations[e.from]);n.querySelector(".question").append(f.text);const q=g.descriptions?.[e.from];q?(p.innerText=q,p.style.display="block"):p.style.display="none",n.querySelector(".buttonDefinition").addEventListener("click",()=>F(g,f.text,e.from)),u.style.display="none",l.value="",Math.random()>.5&&f.text.includes(" ")?(r.style.display="none",c.style.display="block",l.focus()):(r.style.display="block",c.style.display="none"),n.querySelectorAll(".pickAnswer p.answer").forEach(d=>d.remove());const y=V(g,2,e.exercerciseList,e.to),v=L(g.translations[e.to]),w=[v,...y.map(d=>L(d.translations[e.to]))];w.sort(()=>Math.random()-.5);for(const d of w){const h=document.createElement("p");h.className="answer",h.append(d.text),h.addEventListener("click",()=>{l.value=d.text,T()}),r.append(h);const M=document.createElement("button");M.append("Info");const K=y.find(D=>Object.values(D.translations[e.to]).some(Y=>Y===d))||g;M.addEventListener("click",D=>{D.stopPropagation(),F(K,d.text,e.to)}),h.append(M)}m.innerHTML="";const O=Array.from(new Set([...w.flatMap(d=>d.text.split(/\s+|[.多?,?!;]/)).filter(d=>d!==""),...w.flatMap(d=>Array.from(new Set(d.text.replace(/[^.多?,?!;]/g,""))))])).sort(()=>Math.random()-.5);for(const d of O){const h=document.createElement("p");h.className="wordSuggestion",h.append(d),h.addEventListener("click",()=>{l.value===""?l.value=d:/^[.多?,?!;]$/.test(d)?l.value=l.value+d:l.value=l.value+" "+d}),m.append(h)}S.innerHTML="",S.append(v.text)}function T(){if(u.style.display==="none"){const f=g.translations[e.to].some(v=>X(v.text,l.value)),q=JSON.parse(localStorage.knowledge||"{}"),y=q?.[x]?.[g.conceptName]||{lastAnswersCorrect:[],hiddenUntil:0};if(q[x]||(q[x]={}),q[x][g.conceptName]=y,y.lastAnswersCorrect.length>9&&y.lastAnswersCorrect.splice(0,1),y.lastAnswersCorrect.push(f),!f)y.hiddenUntil=0;else{const v=y.lastAnswersCorrect.reduce((w,O)=>O?w+1:w-1,0);y.lastAnswersCorrect.length<10?y.hiddenUntil=new Date().getTime()+v*6e5:y.hiddenUntil=new Date().getTime()+v*864e5}localStorage.knowledge=JSON.stringify(q),f?t.length>0?N():b(x):(r.style.display="none",c.style.display="none",u.querySelector(".wrongAnswer").innerText=l.value,u.style.display="block")}else t.length>0?N():b(x)}const x=`${e.from} to ${e.to}`;n.querySelector(".buttonBack").addEventListener("click",()=>b(x)),n.querySelector(".buttonConfirm").addEventListener("click",()=>T()),l.addEventListener("keypress",f=>{f.key==="Enter"&&T()}),N(),E.append(n),A.style.display="none",H.style.display="none",E.style.display="block"}document.querySelector(".definitionOverlay .buttonBack").addEventListener("click",()=>Z());function Z(){document.querySelector(".definitionOverlay").style.display="none"}const _={"https://creativecommons.org/licenses/by-sa/3.0/":"CC BY-SA 3.0"};function F(e,o,s){const i=document.querySelector(".definitionOverlay");i.querySelector(".title").innerText=o;const t=i.querySelector(".hint"),n=e.descriptions?.[s];n?(t.innerText=n,t.style.display="block"):t.style.display="none";const a=i.querySelector(".translations");a.innerHTML="";for(const[u,S]of Object.entries(e.translations)){const r=document.createElement("h2");r.append(`Translations: ${u}`),a.append(r);for(const c of S){const l=document.createElement("div");l.className="translation",a.append(l);const m=document.createElement("h3");if(m.append(c.text),l.append(m),c.source){const p=document.createElement("a");p.href=c.source,p.append(p.hostname),l.append(p)}if(c.licence){const p=document.createElement("a");p.href=c.licence,p.append(`Licence: ${_[c.licence]||c.licence}`),l.append(p)}}}document.querySelector(".definitionOverlay").style.display="flex"}
