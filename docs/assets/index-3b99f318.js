(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const u of t.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function s(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerpolicy&&(t.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?t.credentials="include":o.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(o){if(o.ep)return;o.ep=!0;const t=s(o);fetch(o.href,t)}})();const B=document.querySelector("#courseTemplate");B.removeAttribute("id");B.remove();const W=document.querySelector("#courseDetailsTemplate");W.removeAttribute("id");W.remove();const A=document.querySelector("#lessonTemplate");A.removeAttribute("id");A.remove();const J=document.querySelector("#lessonOngoingTemplate");J.removeAttribute("id");J.remove();const I=await(await fetch("dist-data/courses/index.json")).json(),E=document.querySelector(".courseList"),H=document.querySelector(".courseDetails"),b=document.querySelector(".lessonOngoing");let M;F();function U(e,n){const s=JSON.parse(localStorage.knowledge||"{}")?.[e]?.[n];if(!s)return"unseen";const l=new Date().getTime();return s.lastAnswersCorrect.length>2&&s.lastAnswersCorrect.every(o=>o)&&l<s.hiddenUntil?"learned":s.lastAnswersCorrect.find((o,t)=>!o&&s.lastAnswersCorrect.length-t<=3)===!1?"wrong":"somewhat"}function z(e,n){const s=I[n],l=Object.keys(JSON.parse(localStorage.knowledge||"{}")?.[n]||{});T(e,n,l,s.exercises)}function T(e,n,s,l){const o=s.map(c=>U(n,c)),t=o.filter(c=>c==="wrong").length,u=o.filter(c=>c==="somewhat").length,p=o.filter(c=>c==="learned").length,S=l-t-u-p;e.querySelector(".wrong").style.flex=t,e.querySelector(".somewhat").style.flex=u,e.querySelector(".learned").style.flex=p,e.querySelector(".unseen").style.flex=S}function F(){E.innerHTML="";const e=Object.keys(I).sort();for(const n of e){const s=I[n],l=B.cloneNode(!0);l.querySelector(".title").append(n),l.querySelector(".hint").append(`${s.lessons} lessons, ${s.exercises} exercises`),l.addEventListener("click",()=>C(n)),z(l.querySelector(".progress"),n),E.append(l)}E.style.display="block",H.style.display="none",b.style.display="none",location.hash.length>1&&(location.hash="",history.replaceState(null,"",location.pathname)),M=void 0}async function C(e){const n=await(await fetch("dist-data/courses/"+encodeURI(e+".json"))).json();H.innerHTML="";const s=W.cloneNode(!0);s.querySelector(".title").append(`${n.from} to ${n.to}`),z(s.querySelector(".progress"),e),s.querySelector(".buttonBack").addEventListener("click",()=>F());const l=s.querySelector(".lessons");for(const c of[...n.lessons].sort((i,r)=>i.order-r.order)){const i=A.cloneNode(!0);i.querySelector(".title").append(c.title[n.to]),i.querySelector(".hint").append(`${c.exercises.length} exercises`),T(i.querySelector(".progress"),e,c.exercises,c.exercises.length),i.addEventListener("click",()=>_(n,c)),l.append(i)}const o=new Set;n.exercerciseList.flatMap(c=>c.categories).forEach(c=>o.add(c));const t=Array.from(o).sort(),u=s.querySelector(".categories");for(const c of t){const i=A.cloneNode(!0);i.querySelector(".title").append(c);const r=n.exercerciseList.filter(y=>y.categories.includes(c));i.querySelector(".hint").append(`${r.length} exercises`),T(i.querySelector(".progress"),e,r.map(y=>y.conceptName),r.length),i.addEventListener("click",()=>R(n,r)),u.append(i)}const p={Training:n.exercerciseList.filter(c=>["wrong","somewhat"].includes(U(e,c.conceptName))),New:n.exercerciseList.filter(c=>U(e,c.conceptName)==="unseen"),Uncategorized:n.exercerciseList.filter(c=>c.categories.length===0)},S=s.querySelector(".dynamicCategories");for(const[c,i]of Object.entries(p)){const r=A.cloneNode(!0);r.querySelector(".title").append(c),r.querySelector(".hint").append(`${i.length} exercises`),T(r.querySelector(".progress"),e,i.map(y=>y.conceptName),i.length),i.length>0&&r.addEventListener("click",()=>R(n,i)),S.append(r)}H.append(s),E.style.display="none",H.style.display="block",b.style.display="none",location.hash="#course",M=e}function _(e,n){const s=e.exercerciseList.filter(l=>n.exercises.includes(l.conceptName));K(e,s)}function R(e,n){K(e,n)}function k(e){return e[Math.floor(Math.random()*e.length)]}function P(e,n,s,l){const o=n.filter(t=>t!==e&&!l.includes(t));if(Math.random()>.5){const t=o.filter(u=>u.categories.some(p=>e.categories.includes(p)));if(t.length>0)return k(t)}if(Math.random()>.5){const t=o.filter(u=>{const p=u.translations[s][0].text.length/e.translations[s][0].text.length;return p>.5&&p<1.5});if(t.length>0)return k(t)}return k(o)}function ee(e,n,s,l){const o=[];for(;o.length<n;)o.push(P(e,s,l,o));return o}function te(e,n){const s=/[.多?,?!;-]/g;return e.replace(s,"").toLowerCase()===n.replace(s,"").toLowerCase()}function K(e,n){const s=Math.min(10,n.length),l=[...n],o=[];for(;o.length<s;){const h=Math.floor(Math.random()*l.length);o.push(...l.splice(h,1))}b.innerHTML="";const t=J.cloneNode(!0),u=t.querySelector("progress");u.max=s,u.value=0;const p=t.querySelector(".correctAnswerHint"),S=t.querySelector(".correctAnswer"),c=t.querySelector(".pickAnswer"),i=t.querySelector(".typeAnswer"),r=t.querySelector("input"),y=t.querySelector(".wordSuggestions"),L=t.querySelector(".questionHint");t.querySelector(".buttonClear").addEventListener("click",()=>r.value="");let a;function O(){a=o.splice(0,1)[0],u.value=s-o.length,t.querySelector(".question").innerHTML="";const h=k(a.translations[e.from]);t.querySelector(".question").append(h.text);const w=a.descriptions?.[e.from];w?(L.innerText=w,L.style.display="block"):L.style.display="none",t.querySelector(".buttonDefinition").addEventListener("click",()=>V(a,h.text,e.from)),p.style.display="none",r.value="",Math.random()>.5&&h.text.includes(" ")?(c.style.display="none",i.style.display="block"):(c.style.display="block",i.style.display="none"),t.querySelectorAll(".pickAnswer p.answer").forEach(d=>d.remove());const m=ee(a,2,e.exercerciseList,e.to),v=k(a.translations[e.to]),g=[v,...m.map(d=>k(d.translations[e.to]))];g.sort(()=>Math.random()-.5);const N=speechSynthesis.getVoices().filter(d=>d.lang.startsWith(e.to)),Q=N.length>0&&Math.random()<.5;for(const d of g){const f=document.createElement("p");if(f.className="answer",Q){const x=document.createElement("button");x.append("Speak"),x.addEventListener("click",()=>{c.querySelectorAll(".selected").forEach(j=>j.className="answer"),f.className="answer selected",r.value=d.text,G(d.text,N)}),f.append(x)}else f.append(d.text),f.addEventListener("click",()=>{r.value=d.text,D()});c.append(f);const $=document.createElement("button");$.append("Info");const Z=m.find(x=>Object.values(x.translations[e.to]).some(j=>j===d))||a;$.addEventListener("click",x=>{x.stopPropagation(),V(Z,d.text,e.to)}),f.append($)}y.innerHTML="";const X=Array.from(new Set([...g.flatMap(d=>d.text.split(/\s+|[.多?,?!;]/)).filter(d=>d!==""),...g.flatMap(d=>Array.from(new Set(d.text.replace(/[^.多?,?!;]/g,""))))])).sort(()=>Math.random()-.5);for(const d of X){const f=document.createElement("p");f.className="wordSuggestion",f.append(d),f.addEventListener("click",()=>{r.value===""?r.value=d:/^[.多?,?!;]$/.test(d)?r.value=r.value+d:r.value=r.value+" "+d}),y.append(f)}S.innerHTML="",S.append(v.text)}function D(){if(p.style.display==="none"){const h=a.translations[e.to].some(v=>te(v.text,r.value)),w=JSON.parse(localStorage.knowledge||"{}"),m=w?.[q]?.[a.conceptName]||{lastAnswersCorrect:[],hiddenUntil:0};if(w[q]||(w[q]={}),w[q][a.conceptName]=m,m.lastAnswersCorrect.length>9&&m.lastAnswersCorrect.splice(0,1),m.lastAnswersCorrect.push(h),!h)m.hiddenUntil=0;else{const v=m.lastAnswersCorrect.reduce((g,N)=>N?g+1:g-1,0);m.lastAnswersCorrect.length<10?m.hiddenUntil=new Date().getTime()+v*6e5:m.hiddenUntil=new Date().getTime()+v*864e5}localStorage.knowledge=JSON.stringify(w),h?o.length>0?O():C(q):(c.style.display="none",i.style.display="none",p.querySelector(".wrongAnswer").innerText=r.value,p.style.display="block")}else o.length>0?O():C(q)}const q=`${e.from} to ${e.to}`;t.querySelector(".buttonBack").addEventListener("click",()=>C(q)),t.querySelector(".buttonConfirm").addEventListener("click",()=>D()),r.addEventListener("keypress",h=>{h.key==="Enter"&&D()}),O(),b.append(t),E.style.display="none",H.style.display="none",b.style.display="block",location.hash="#lesson"}document.querySelector(".definitionOverlay .buttonBack").addEventListener("click",()=>Y());function Y(){document.querySelector(".definitionOverlay").style.display="none",location.hash="#lesson"}const ne={"https://creativecommons.org/licenses/by-sa/3.0/":"CC BY-SA 3.0"};function V(e,n,s){const l=document.querySelector(".definitionOverlay");l.querySelector(".title").innerText=n;const o=l.querySelector(".hint"),t=e.descriptions?.[s];t?(o.innerText=t,o.style.display="block"):o.style.display="none";const u=l.querySelector(".translations");u.innerHTML="";for(const[p,S]of Object.entries(e.translations)){const c=document.createElement("h2");c.append(`Translations: ${p}`),u.append(c);const i=speechSynthesis.getVoices().filter(r=>r.lang.startsWith(p));for(const r of S){const y=document.createElement("div");y.className="translation",u.append(y);const L=document.createElement("h3");if(L.append(r.text),y.append(L),i.length>0){const a=document.createElement("button");a.append("Speak"),a.addEventListener("click",()=>G(r.text,i)),y.append(a)}if(r.source){const a=document.createElement("a");a.href=r.source,r.author?a.append(`${r.author}, ${a.hostname}`):a.append(a.hostname),y.append(a)}if(r.licence){const a=document.createElement("a");a.href=r.licence,a.append(`Licence: ${ne[r.licence]||r.licence}`),y.append(a)}}}document.querySelector(".definitionOverlay").style.display="flex",location.hash="#definition"}function G(e,n){const s=new SpeechSynthesisUtterance(e);s.voice=k(n),s.lang=s.voice.lang,speechSynthesis.speak(s)}addEventListener("hashchange",()=>{location.hash==="#lesson"&&Y(),location.hash==="#course"&&M&&C(M),(location.hash===""||location.hash==="#")&&F()});
