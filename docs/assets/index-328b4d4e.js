(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const u of t.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function o(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerpolicy&&(t.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?t.credentials="include":s.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(s){if(s.ep)return;s.ep=!0;const t=o(s);fetch(s.href,t)}})();const B=document.querySelector("#courseTemplate");B.removeAttribute("id");B.remove();const W=document.querySelector("#courseDetailsTemplate");W.removeAttribute("id");W.remove();const A=document.querySelector("#lessonTemplate");A.removeAttribute("id");A.remove();const J=document.querySelector("#lessonOngoingTemplate");J.removeAttribute("id");J.remove();const I=await(await fetch("dist-data/courses/index.json")).json(),E=document.querySelector(".courseList"),H=document.querySelector(".courseDetails"),b=document.querySelector(".lessonOngoing");let M;F();function U(e,n){const o=JSON.parse(localStorage.knowledge||"{}")?.[e]?.[n];if(!o)return"unseen";const l=new Date().getTime();return o.lastAnswersCorrect.length>2&&o.lastAnswersCorrect.every(s=>s)&&l<o.hiddenUntil?"learned":o.lastAnswersCorrect.find((s,t)=>!s&&o.lastAnswersCorrect.length-t<=3)===!1?"wrong":"somewhat"}function z(e,n){const o=I[n],l=Object.keys(JSON.parse(localStorage.knowledge||"{}")?.[n]||{});T(e,n,l,o.exercises)}function T(e,n,o,l){const s=o.map(r=>U(n,r)),t=s.filter(r=>r==="wrong").length,u=s.filter(r=>r==="somewhat").length,p=s.filter(r=>r==="learned").length,S=l-t-u-p;e.querySelector(".wrong").style.flex=t,e.querySelector(".somewhat").style.flex=u,e.querySelector(".learned").style.flex=p,e.querySelector(".unseen").style.flex=S}function F(){E.innerHTML="";const e=Object.keys(I);for(const n of e){const o=I[n],l=B.cloneNode(!0);l.querySelector(".title").append(n),l.querySelector(".hint").append(`${o.lessons} lessons, ${o.exercises} exercises`),l.addEventListener("click",()=>C(n)),z(l.querySelector(".progress"),n),E.append(l)}E.style.display="block",H.style.display="none",b.style.display="none",location.hash.length>1&&(location.hash="",history.replaceState(null,"",location.pathname)),M=void 0}async function C(e){const n=await(await fetch("dist-data/courses/"+encodeURI(e+".json"))).json();H.innerHTML="";const o=W.cloneNode(!0);o.querySelector(".title").append(`${n.from} to ${n.to}`),z(o.querySelector(".progress"),e),o.querySelector(".buttonBack").addEventListener("click",()=>F());const l=o.querySelector(".lessons");for(const r of[...n.lessons].sort((i,c)=>i.order-c.order)){const i=A.cloneNode(!0);i.querySelector(".title").append(r.title[n.to]),i.querySelector(".hint").append(`${r.exercises.length} exercises`),T(i.querySelector(".progress"),e,r.exercises,r.exercises.length),i.addEventListener("click",()=>_(n,r)),l.append(i)}const s=new Set;n.exercerciseList.flatMap(r=>r.categories).forEach(r=>s.add(r));const t=Array.from(s).sort(),u=o.querySelector(".categories");for(const r of t){const i=A.cloneNode(!0);i.querySelector(".title").append(r);const c=n.exercerciseList.filter(y=>y.categories.includes(r));i.querySelector(".hint").append(`${c.length} exercises`),T(i.querySelector(".progress"),e,c.map(y=>y.conceptName),c.length),i.addEventListener("click",()=>R(n,c)),u.append(i)}const p={Training:n.exercerciseList.filter(r=>["wrong","somewhat"].includes(U(e,r.conceptName))),New:n.exercerciseList.filter(r=>U(e,r.conceptName)==="unseen"),Uncategorized:n.exercerciseList.filter(r=>r.categories.length===0)},S=o.querySelector(".dynamicCategories");for(const[r,i]of Object.entries(p)){const c=A.cloneNode(!0);c.querySelector(".title").append(r),c.querySelector(".hint").append(`${i.length} exercises`),T(c.querySelector(".progress"),e,i.map(y=>y.conceptName),i.length),i.length>0&&c.addEventListener("click",()=>R(n,i)),S.append(c)}H.append(o),E.style.display="none",H.style.display="block",b.style.display="none",location.hash="#course",M=e}function _(e,n){const o=e.exercerciseList.filter(l=>n.exercises.includes(l.conceptName));K(e,o)}function R(e,n){K(e,n)}function k(e){return e[Math.floor(Math.random()*e.length)]}function P(e,n,o,l){const s=n.filter(t=>t!==e&&!l.includes(t));if(Math.random()>.5){const t=s.filter(u=>u.categories.some(p=>e.categories.includes(p)));if(t.length>0)return k(t)}if(Math.random()>.5){const t=s.filter(u=>{const p=u.translations[o][0].text.length/e.translations[o][0].text.length;return p>.5&&p<1.5});if(t.length>0)return k(t)}return k(s)}function ee(e,n,o,l){const s=[];for(;s.length<n;)s.push(P(e,o,l,s));return s}function te(e,n){const o=/[.多?,?!;-]/g;return e.replace(o,"").toLowerCase()===n.replace(o,"").toLowerCase()}function K(e,n){const o=Math.min(10,n.length),l=[...n],s=[];for(;s.length<o;){const h=Math.floor(Math.random()*l.length);s.push(...l.splice(h,1))}b.innerHTML="";const t=J.cloneNode(!0),u=t.querySelector("progress");u.max=o,u.value=0;const p=t.querySelector(".correctAnswerHint"),S=t.querySelector(".correctAnswer"),r=t.querySelector(".pickAnswer"),i=t.querySelector(".typeAnswer"),c=t.querySelector("input"),y=t.querySelector(".wordSuggestions"),L=t.querySelector(".questionHint");t.querySelector(".buttonClear").addEventListener("click",()=>c.value="");let d;function O(){d=s.splice(0,1)[0],u.value=o-s.length,t.querySelector(".question").innerHTML="";const h=k(d.translations[e.from]);t.querySelector(".question").append(h.text);const w=d.descriptions?.[e.from];w?(L.innerText=w,L.style.display="block"):L.style.display="none",t.querySelector(".buttonDefinition").addEventListener("click",()=>V(d,h.text,e.from)),p.style.display="none",c.value="",Math.random()>.5&&h.text.includes(" ")?(r.style.display="none",i.style.display="block"):(r.style.display="block",i.style.display="none"),t.querySelectorAll(".pickAnswer p.answer").forEach(a=>a.remove());const m=ee(d,2,e.exercerciseList,e.to),v=k(d.translations[e.to]),g=[v,...m.map(a=>k(a.translations[e.to]))];g.sort(()=>Math.random()-.5);const N=speechSynthesis.getVoices().filter(a=>a.lang.startsWith(e.to)),Q=N.length>0&&Math.random()<.5;for(const a of g){const f=document.createElement("p");if(f.className="answer",Q){const x=document.createElement("button");x.append("Speak"),x.addEventListener("click",()=>{r.querySelectorAll(".selected").forEach(j=>j.className="answer"),f.className="answer selected",c.value=a.text,G(a.text,N)}),f.append(x)}else f.append(a.text),f.addEventListener("click",()=>{c.value=a.text,D()});r.append(f);const $=document.createElement("button");$.append("Info");const Z=m.find(x=>Object.values(x.translations[e.to]).some(j=>j===a))||d;$.addEventListener("click",x=>{x.stopPropagation(),V(Z,a.text,e.to)}),f.append($)}y.innerHTML="";const X=Array.from(new Set([...g.flatMap(a=>a.text.split(/\s+|[.多?,?!;]/)).filter(a=>a!==""),...g.flatMap(a=>Array.from(new Set(a.text.replace(/[^.多?,?!;]/g,""))))])).sort(()=>Math.random()-.5);for(const a of X){const f=document.createElement("p");f.className="wordSuggestion",f.append(a),f.addEventListener("click",()=>{c.value===""?c.value=a:/^[.多?,?!;]$/.test(a)?c.value=c.value+a:c.value=c.value+" "+a}),y.append(f)}S.innerHTML="",S.append(v.text)}function D(){if(p.style.display==="none"){const h=d.translations[e.to].some(v=>te(v.text,c.value)),w=JSON.parse(localStorage.knowledge||"{}"),m=w?.[q]?.[d.conceptName]||{lastAnswersCorrect:[],hiddenUntil:0};if(w[q]||(w[q]={}),w[q][d.conceptName]=m,m.lastAnswersCorrect.length>9&&m.lastAnswersCorrect.splice(0,1),m.lastAnswersCorrect.push(h),!h)m.hiddenUntil=0;else{const v=m.lastAnswersCorrect.reduce((g,N)=>N?g+1:g-1,0);m.lastAnswersCorrect.length<10?m.hiddenUntil=new Date().getTime()+v*6e5:m.hiddenUntil=new Date().getTime()+v*864e5}localStorage.knowledge=JSON.stringify(w),h?s.length>0?O():C(q):(r.style.display="none",i.style.display="none",p.querySelector(".wrongAnswer").innerText=c.value,p.style.display="block")}else s.length>0?O():C(q)}const q=`${e.from} to ${e.to}`;t.querySelector(".buttonBack").addEventListener("click",()=>C(q)),t.querySelector(".buttonConfirm").addEventListener("click",()=>D()),c.addEventListener("keypress",h=>{h.key==="Enter"&&D()}),O(),b.append(t),E.style.display="none",H.style.display="none",b.style.display="block",location.hash="#lesson"}document.querySelector(".definitionOverlay .buttonBack").addEventListener("click",()=>Y());function Y(){document.querySelector(".definitionOverlay").style.display="none",location.hash="#lesson"}const ne={"https://creativecommons.org/licenses/by-sa/3.0/":"CC BY-SA 3.0"};function V(e,n,o){const l=document.querySelector(".definitionOverlay");l.querySelector(".title").innerText=n;const s=l.querySelector(".hint"),t=e.descriptions?.[o];t?(s.innerText=t,s.style.display="block"):s.style.display="none";const u=l.querySelector(".translations");u.innerHTML="";for(const[p,S]of Object.entries(e.translations)){const r=document.createElement("h2");r.append(`Translations: ${p}`),u.append(r);const i=speechSynthesis.getVoices().filter(c=>c.lang.startsWith(p));for(const c of S){const y=document.createElement("div");y.className="translation",u.append(y);const L=document.createElement("h3");if(L.append(c.text),y.append(L),i.length>0){const d=document.createElement("button");d.append("Speak"),d.addEventListener("click",()=>G(c.text,i)),y.append(d)}if(c.source){const d=document.createElement("a");d.href=c.source,d.append(d.hostname),y.append(d)}if(c.licence){const d=document.createElement("a");d.href=c.licence,d.append(`Licence: ${ne[c.licence]||c.licence}`),y.append(d)}}}document.querySelector(".definitionOverlay").style.display="flex",location.hash="#definition"}function G(e,n){const o=new SpeechSynthesisUtterance(e);o.voice=k(n),o.lang=o.voice.lang,speechSynthesis.speak(o)}addEventListener("hashchange",()=>{location.hash==="#lesson"&&Y(),location.hash==="#course"&&M&&C(M),(location.hash===""||location.hash==="#")&&F()});
