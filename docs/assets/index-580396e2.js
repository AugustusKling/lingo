(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const d of t.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerpolicy&&(t.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?t.credentials="include":o.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(o){if(o.ep)return;o.ep=!0;const t=s(o);fetch(o.href,t)}})();const U=document.querySelector("#courseTemplate");U.removeAttribute("id");U.remove();const B=document.querySelector("#courseDetailsTemplate");B.removeAttribute("id");B.remove();const L=document.querySelector("#lessonTemplate");L.removeAttribute("id");L.remove();const J=document.querySelector("#lessonOngoingTemplate");J.removeAttribute("id");J.remove();const j=await(await fetch("dist-data/courses/index.json")).json(),A=document.querySelector(".courseList"),H=document.querySelector(".courseDetails"),E=document.querySelector(".lessonOngoing");let N;W();function I(e,n){const s=JSON.parse(localStorage.knowledge||"{}")?.[e]?.[n];if(!s)return"unseen";const l=new Date().getTime();return s.lastAnswersCorrect.length>2&&s.lastAnswersCorrect.every(o=>o)&&l<s.hiddenUntil?"learned":s.lastAnswersCorrect.find((o,t)=>!o&&s.lastAnswersCorrect.length-t<=3)===!1?"wrong":"somewhat"}function z(e,n){const s=j[n],l=Object.keys(JSON.parse(localStorage.knowledge||"{}")?.[n]||{});C(e,n,l,s.exercises)}function C(e,n,s,l){const o=s.map(r=>I(n,r)),t=o.filter(r=>r==="wrong").length,d=o.filter(r=>r==="somewhat").length,p=o.filter(r=>r==="learned").length,S=l-t-d-p;e.querySelector(".wrong").style.flex=t,e.querySelector(".somewhat").style.flex=d,e.querySelector(".learned").style.flex=p,e.querySelector(".unseen").style.flex=S}function W(){A.innerHTML="";const e=Object.keys(j);for(const n of e){const s=j[n],l=U.cloneNode(!0);l.querySelector(".title").append(n),l.querySelector(".hint").append(`${s.lessons} lessons, ${s.exercises} exercises`),l.addEventListener("click",()=>b(n)),z(l.querySelector(".progress"),n),A.append(l)}A.style.display="block",H.style.display="none",E.style.display="none",location.hash.length>1&&(location.hash="",history.replaceState(null,"",location.pathname)),N=void 0}async function b(e){const n=await(await fetch("dist-data/courses/"+encodeURI(e+".json"))).json();H.innerHTML="";const s=B.cloneNode(!0);s.querySelector(".title").append(`${n.from} to ${n.to}`),z(s.querySelector(".progress"),e),s.querySelector(".buttonBack").addEventListener("click",()=>W());const l=s.querySelector(".lessons");for(const r of[...n.lessons].sort((i,c)=>i.order-c.order)){const i=L.cloneNode(!0);i.querySelector(".title").append(r.title[n.to]),i.querySelector(".hint").append(`${r.exercises.length} exercises`),C(i.querySelector(".progress"),e,r.exercises,r.exercises.length),i.addEventListener("click",()=>Q(n,r)),l.append(i)}const o=new Set;n.exercerciseList.flatMap(r=>r.categories).forEach(r=>o.add(r));const t=Array.from(o).sort(),d=s.querySelector(".categories");for(const r of t){const i=L.cloneNode(!0);i.querySelector(".title").append(r);const c=n.exercerciseList.filter(y=>y.categories.includes(r));i.querySelector(".hint").append(`${c.length} exercises`),C(i.querySelector(".progress"),e,c.map(y=>y.conceptName),c.length),i.addEventListener("click",()=>F(n,c)),d.append(i)}const p={Training:n.exercerciseList.filter(r=>["wrong","somewhat"].includes(I(e,r.conceptName))),New:n.exercerciseList.filter(r=>I(e,r.conceptName)==="unseen"),Uncategorized:n.exercerciseList.filter(r=>r.categories.length===0)},S=s.querySelector(".dynamicCategories");for(const[r,i]of Object.entries(p)){const c=L.cloneNode(!0);c.querySelector(".title").append(r),c.querySelector(".hint").append(`${i.length} exercises`),C(c.querySelector(".progress"),e,i.map(y=>y.conceptName),i.length),i.length>0&&c.addEventListener("click",()=>F(n,i)),S.append(c)}H.append(s),A.style.display="none",H.style.display="block",E.style.display="none",location.hash="#course",N=e}function Q(e,n){const s=e.exercerciseList.filter(l=>n.exercises.includes(l.conceptName));K(e,s)}function F(e,n){K(e,n)}function x(e){return e[Math.floor(Math.random()*e.length)]}function X(e,n,s,l){const o=n.filter(t=>t!==e&&!l.includes(t));if(Math.random()>.5){const t=o.filter(d=>d.categories.some(p=>e.categories.includes(p)));if(t.length>0)return x(t)}if(Math.random()>.5){const t=o.filter(d=>{const p=d.translations[s][0].text.length/e.translations[s][0].text.length;return p>.5&&p<1.5});if(t.length>0)return x(t)}return x(o)}function Z(e,n,s,l){const o=[];for(;o.length<n;)o.push(X(e,s,l,o));return o}function _(e,n){const s=/[.多?,?!;-]/g;return e.replace(s,"").toLowerCase()===n.replace(s,"").toLowerCase()}function K(e,n){const s=Math.min(10,n.length),l=[...n],o=[];for(;o.length<s;){const f=Math.floor(Math.random()*l.length);o.push(...l.splice(f,1))}E.innerHTML="";const t=J.cloneNode(!0),d=t.querySelector("progress");d.max=s,d.value=0;const p=t.querySelector(".correctAnswerHint"),S=t.querySelector(".correctAnswer"),r=t.querySelector(".pickAnswer"),i=t.querySelector(".typeAnswer"),c=t.querySelector("input"),y=t.querySelector(".wordSuggestions"),k=t.querySelector(".questionHint");t.querySelector(".buttonClear").addEventListener("click",()=>c.value="");let a;function T(){a=o.splice(0,1)[0],d.value=s-o.length,t.querySelector(".question").innerHTML="";const f=x(a.translations[e.from]);t.querySelector(".question").append(f.text);const w=a.descriptions?.[e.from];w?(k.innerText=w,k.style.display="block"):k.style.display="none",t.querySelector(".buttonDefinition").addEventListener("click",()=>R(a,f.text,e.from)),p.style.display="none",c.value="",Math.random()>.5&&f.text.includes(" ")?(r.style.display="none",i.style.display="block"):(r.style.display="block",i.style.display="none"),t.querySelectorAll(".pickAnswer p.answer").forEach(u=>u.remove());const m=Z(a,2,e.exercerciseList,e.to),v=x(a.translations[e.to]),g=[v,...m.map(u=>x(u.translations[e.to]))];g.sort(()=>Math.random()-.5);for(const u of g){const h=document.createElement("p");h.className="answer",h.append(u.text),h.addEventListener("click",()=>{c.value=u.text,O()}),r.append(h);const D=document.createElement("button");D.append("Info");const Y=m.find($=>Object.values($.translations[e.to]).some(G=>G===u))||a;D.addEventListener("click",$=>{$.stopPropagation(),R(Y,u.text,e.to)}),h.append(D)}y.innerHTML="";const M=Array.from(new Set([...g.flatMap(u=>u.text.split(/\s+|[.多?,?!;]/)).filter(u=>u!==""),...g.flatMap(u=>Array.from(new Set(u.text.replace(/[^.多?,?!;]/g,""))))])).sort(()=>Math.random()-.5);for(const u of M){const h=document.createElement("p");h.className="wordSuggestion",h.append(u),h.addEventListener("click",()=>{c.value===""?c.value=u:/^[.多?,?!;]$/.test(u)?c.value=c.value+u:c.value=c.value+" "+u}),y.append(h)}S.innerHTML="",S.append(v.text)}function O(){if(p.style.display==="none"){const f=a.translations[e.to].some(v=>_(v.text,c.value)),w=JSON.parse(localStorage.knowledge||"{}"),m=w?.[q]?.[a.conceptName]||{lastAnswersCorrect:[],hiddenUntil:0};if(w[q]||(w[q]={}),w[q][a.conceptName]=m,m.lastAnswersCorrect.length>9&&m.lastAnswersCorrect.splice(0,1),m.lastAnswersCorrect.push(f),!f)m.hiddenUntil=0;else{const v=m.lastAnswersCorrect.reduce((g,M)=>M?g+1:g-1,0);m.lastAnswersCorrect.length<10?m.hiddenUntil=new Date().getTime()+v*6e5:m.hiddenUntil=new Date().getTime()+v*864e5}localStorage.knowledge=JSON.stringify(w),f?o.length>0?T():b(q):(r.style.display="none",i.style.display="none",p.querySelector(".wrongAnswer").innerText=c.value,p.style.display="block")}else o.length>0?T():b(q)}const q=`${e.from} to ${e.to}`;t.querySelector(".buttonBack").addEventListener("click",()=>b(q)),t.querySelector(".buttonConfirm").addEventListener("click",()=>O()),c.addEventListener("keypress",f=>{f.key==="Enter"&&O()}),T(),E.append(t),A.style.display="none",H.style.display="none",E.style.display="block",location.hash="#lesson"}document.querySelector(".definitionOverlay .buttonBack").addEventListener("click",()=>V());function V(){document.querySelector(".definitionOverlay").style.display="none",location.hash="#lesson"}const P={"https://creativecommons.org/licenses/by-sa/3.0/":"CC BY-SA 3.0"};function R(e,n,s){const l=document.querySelector(".definitionOverlay");l.querySelector(".title").innerText=n;const o=l.querySelector(".hint"),t=e.descriptions?.[s];t?(o.innerText=t,o.style.display="block"):o.style.display="none";const d=l.querySelector(".translations");d.innerHTML="";for(const[p,S]of Object.entries(e.translations)){const r=document.createElement("h2");r.append(`Translations: ${p}`),d.append(r);const i=speechSynthesis.getVoices().filter(c=>c.lang.startsWith(p));for(const c of S){const y=document.createElement("div");y.className="translation",d.append(y);const k=document.createElement("h3");if(k.append(c.text),y.append(k),i.length>0){const a=document.createElement("button");a.append("Speak"),a.addEventListener("click",()=>ee(c.text,i)),y.append(a)}if(c.source){const a=document.createElement("a");a.href=c.source,a.append(a.hostname),y.append(a)}if(c.licence){const a=document.createElement("a");a.href=c.licence,a.append(`Licence: ${P[c.licence]||c.licence}`),y.append(a)}}}document.querySelector(".definitionOverlay").style.display="flex",location.hash="#definition"}function ee(e,n){const s=new SpeechSynthesisUtterance(e);s.voice=x(n),speechSynthesis.speak(s)}addEventListener("hashchange",()=>{location.hash==="#lesson"&&V(),location.hash==="#course"&&N&&b(N),(location.hash===""||location.hash==="#")&&W()});
